<!-- ============================
     LANDING / FORMULARIO PROYECTO
============================ -->
<div class="container mt-5">
  <!-- Card principal -->
  <div class="card project-card">
    <!-- Bot칩n regresar -->
    <button class="btn btn-back" (click)="goBack()">
      <i class="bi bi-arrow-left"></i> Regresar
    </button>

    <!-- T칤tulo -->
    <h3 class="fw-bold title text-gradient text-center mb-4">
      <i class="bi bi-kanban-fill me-2"></i> Crear Proyecto
      <i class="bi bi-rocket-takeoff-fill ms-2"></i>
    </h3>

    <!-- Formulario -->
    <form [formGroup]="projectForm" (ngSubmit)="createProject()" class="project-form">
      <!-- Nombre -->
      <div class="form-group mb-4 floating-label position-relative">
        <input
          type="text"
          class="form-control stylish-input"
          formControlName="name"
          placeholder=" "
        />
        <label>Nombre</label>

        <!-- Mensaje de error profesional -->
        <div
          *ngIf="projectForm.get('name')?.invalid && projectForm.get('name')?.touched"
          class="text-error-pro fade-slide"
        >
          <i class="bi bi-exclamation-circle-fill me-1"></i>
          Este campo es obligatorio para continuar
        </div>
      </div>

      <!-- Descripci칩n -->
      <div class="form-group mb-4 floating-label position-relative">
        <textarea
          class="form-control stylish-input auto-resize-textarea"
          formControlName="description"
          rows="1"
          placeholder=" "
          (input)="autoResize($event)"
        ></textarea>
        <label>Descripci칩n</label>
      </div>

      <!-- Fecha l칤mite -->
      <div class="form-group mb-4 floating-label position-relative">
        <input
          type="date"
          class="form-control stylish-input date-input"
          formControlName="deadline"
          placeholder=" "
        />
        <label>Fecha l칤mite</label>
        <i class="bi bi-calendar-date-fill calendar-icon"></i>
      </div>

      <!-- Estado -->
      <div class="form-group mb-4 floating-label position-relative">
        <select class="form-select stylish-input select-input" formControlName="status">
          <option value="" disabled selected hidden></option>
          <!-- placeholder invisible -->
          <option value="active">Activo</option>
          <option value="completed">Completado</option>
          <option value="archived">Archivado</option>
        </select>
        <label>Estado</label>
      </div>

      <!-- Colaboradores Mejorado -->
      <div class="form-group mb-4">
        <label class="form-label fw-bold">Colaboradores</label>

        <!-- Contenedor de badges -->
        <div class="selected-collaborators mb-2">
          <span *ngFor="let col of selectedCollaborators" class="badge-collab">
            {{ col.username }}
            <i class="remove-collab bi bi-x"></i>
          </span>
        </div>

        <!-- Bot칩n a침adir colaboradores -->
        <button type="button" class="btn-add-collab" (click)="openCollaboratorsModal()">
          + A침adir colaboradores
        </button>
      </div>

      <!-- Botones -->
      <div class="d-flex justify-content-end gap-3 mt-4">
        <button class="btn btn-cancel" type="button" (click)="goBack()">Cancelar</button>
        <button class="btn btn-gradient" type="submit">Crear</button>
      </div>

      <!-- Error -->
      <div *ngIf="error" class="text-error mt-3 text-center">{{ error }}</div>
    </form>
  </div>
</div>

<!-- ============================
     MODAL COLABORADORES
============================ -->
<div class="modal fade" id="collaboratorsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content modal-modern">
      <!-- Header -->
      <div class="modal-header border-0">
        <h5 class="modal-title text-gradient">游논 Seleccionar colaboradores</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <!-- Input de b칰squeda -->
        <div class="search-wrapper mb-3">
          <input
            type="text"
            class="form-control stylish-input search-input"
            placeholder="Buscar usuario..."
            [(ngModel)]="searchTerm"
          />
          <i class="bi bi-search search-icon"></i>
        </div>

        <!-- Lista de usuarios -->
        <div class="user-list">
          <div *ngFor="let u of filteredUsers()" class="user-item">
            <div class="user-info">
              <strong>{{ u.username }}</strong>
              <small class="text-muted d-block">{{ u.email }}</small>
            </div>
            <label class="checkbox-wrapper">
              <input type="checkbox" [checked]="isSelected(u)" (change)="toggleCollaborator(u)" />
              <span class="checkmark"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-outline-secondary btn-modal" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button type="button" class="btn btn-gradient btn-modal" data-bs-dismiss="modal">
          Confirmar
        </button>
      </div>
    </div>
  </div>
</div>
