<div class="requirement-container" *ngIf="!loading && requirement; else loadingState">
  <!-- Botón Volver -->
  <button class="btn btn-outline-primary back-btn" (click)="goBack()">
    <i class="bi bi-arrow-left"></i> Volver al proyecto
  </button>

  <!-- Encabezado -->
  <div class="requirement-header card shadow-sm p-4 mb-4 animate-fade-in">
    <h2 class="mb-2 text-primary fw-bold">
      <i class="bi bi-file-earmark-text"></i> {{ requirement.title }}
    </h2>
    <div class="d-flex flex-wrap gap-3 mt-2">
      <span class="badge bg-info text-dark px-3 py-2">Estado: {{ requirement.status }}</span>
      <span class="badge bg-warning text-dark px-3 py-2">Prioridad: {{ requirement.priority }}</span>
      <span class="badge bg-secondary px-3 py-2">Versión: {{ requirement.version }}</span>
    </div>
  </div>

  <!-- Descripción -->
  <div class="card description-card shadow-sm animate-slide-up">
    <div class="card-body">
      <h5 class="card-title text-secondary mb-3">
        <i class="bi bi-journal-text"></i> Descripción
      </h5>
      <p class="mb-2 text-muted">{{ requirement.text }}</p>
      <p *ngIf="requirement.context" class="fst-italic">
        <strong>Contexto:</strong> {{ requirement.context }}
      </p>
    </div>
  </div>

  <!-- Sección de análisis -->
  <div *ngIf="analysis" class="analysis-section mt-5 animate-fade-in">
    <h4 class="text-success fw-bold mb-3">
      <i class="bi bi-bar-chart-line"></i> Análisis del Requisito
    </h4>

    <div class="card shadow-sm mb-4 border-success border-opacity-25">
      <div class="card-body">
        <p class="mb-2">
          <strong>Promedio de Cumplimiento:</strong>
          <span class="text-success fw-semibold">{{ analysis.promedio_cumplimiento }}%</span>
        </p>

        <div class="alert alert-info mt-3">
          <strong>Resultado general:</strong>
          {{ analysis.refined_requirement.estado | titlecase }} -
          {{ analysis.refined_requirement.mensaje }}
        </div>
      </div>
    </div>

    <h5 class="mt-4 mb-3 text-primary fw-semibold">
      <i class="bi bi-people"></i> Análisis por Agente
    </h5>

    <div class="row g-3">
      <div *ngFor="let key of analysis.agents | keyvalue" class="col-md-6">
        <div class="card agent-card shadow-sm border-light animate-slide-up">
          <div class="card-body">
            <h6 class="text-primary fw-bold mb-3">
              <i class="bi bi-person-badge"></i> {{ key.value.role }}
            </h6>
            <ul class="list-unstyled ms-3">
              <li *ngFor="let k of key.value.analysis | keyvalue" class="mb-1">
                <strong>{{ k.key | titlecase }}:</strong>
                <span class="text-muted">{{ k.value }}</span>
              </li>
            </ul>
            <p class="mt-3">
              <strong>Porcentaje:</strong>
              <span class="text-success fw-semibold">{{ key.value.porcentaje }}%</span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Estado de carga -->
<ng-template #loadingState>
  <div class="text-center py-5 loading-spinner animate-fade-in">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-3 text-muted">Cargando requisito...</p>
  </div>
</ng-template>
